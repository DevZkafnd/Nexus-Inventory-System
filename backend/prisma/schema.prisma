generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  STAFF
}

enum TransactionType {
  INBOUND
  OUTBOUND
  TRANSFER
  INITIAL_ADJUSTMENT
}

model Product {
  id           String   @id @default(uuid())
  sku          String   @unique
  name         String
  category     String?
  priceCents   Int?
  dimensions   String?
  isDeleted    Boolean  @default(false)
  stocks       StockItem[]
  transactions Transaction[]
}

model Warehouse {
  id        String     @id @default(uuid())
  name      String
  location  String
  code      String?    @unique
  capacity  Int?
  stocks    StockItem[]
  sourceTx  Transaction[] @relation("SourceWarehouse")
  targetTx  Transaction[] @relation("TargetWarehouse")
  users     UserWarehouse[]
}

model StockItem {
  id          String    @id @default(uuid())
  product     Product   @relation(fields: [productId], references: [id])
  productId   String
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
  warehouseId String
  quantity    Int       @default(0)

  @@unique([productId, warehouseId])
}

model Transaction {
  id               String          @id @default(uuid())
  type             TransactionType
  product          Product         @relation(fields: [productId], references: [id])
  productId        String
  sourceWarehouse  Warehouse?      @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
  sourceWarehouseId String?
  targetWarehouse  Warehouse?      @relation("TargetWarehouse", fields: [targetWarehouseId], references: [id])
  targetWarehouseId String?
  quantity         Int
  timestamp        DateTime        @default(now())
  referenceNote    String?
}

model User {
  id         String          @id @default(uuid())
  email      String          @unique
  name       String?
  role       Role
  createdAt  DateTime        @default(now())
  passwordHash String?
  passwordSalt String?
  warehouses UserWarehouse[]
}

model UserWarehouse {
  id          String    @id @default(uuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
  warehouseId String

  @@unique([userId, warehouseId])
}
